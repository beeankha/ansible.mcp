---
- name: Setup integration test inventory
  hosts: localhost
  connection: local
  gather_facts: false
  vars:
    # Default to the test target directory if not specified
    target_dir: "{{ ansible_mcp_target_dir | default(playbook_dir | dirname | dirname + '/targets') }}"
    integration_dir: "{{ playbook_dir | dirname | dirname }}"
    ansible_mcp_inventory_dir: "{{ ansible_mcp_inventory_dir | default(target_dir) }}"
    ansible_mcp_inventory_file: "{{ ansible_mcp_inventory_file | default(ansible_mcp_inventory_dir + '/inventory.yml') }}"
    # Default to shared mcpservers.json in integration directory, allow per-target override
    ansible_mcp_manifest_path: "{{ ansible_mcp_manifest_path | default(integration_dir + '/mcpservers.json') }}"
    github_mcp_pat: "{{ github_mcp_pat | default('') }}"
  roles:
    - role: setup
      vars:
        ansible_mcp_inventory_dir: "{{ ansible_mcp_inventory_dir }}"
        ansible_mcp_inventory_file: "{{ ansible_mcp_inventory_file }}"
        ansible_mcp_manifest_path: "{{ ansible_mcp_manifest_path }}"
        github_mcp_pat: "{{ github_mcp_pat }}"
