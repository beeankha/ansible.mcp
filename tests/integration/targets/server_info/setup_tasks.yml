---
# This playbook is based on roles/setup/
# It exists in the target directory for ansible-test compatibility
# The canonical source is roles/setup/tasks/main.yml - update tasks when the role changes
- name: Setup integration test inventory
  hosts: localhost
  connection: local
  gather_facts: false
  vars:
    # Default to the test target directory if not specified
    target_dir: "{{ ansible_mcp_target_dir | default(playbook_dir) }}"
    integration_dir: "{{ playbook_dir | dirname | dirname }}"
    ansible_mcp_inventory_dir: "{{ ansible_mcp_inventory_dir | default(target_dir) }}"
    ansible_mcp_inventory_file: "{{ ansible_mcp_inventory_file | default(ansible_mcp_inventory_dir + '/inventory.yml') }}"
    # Default to shared mcpservers.json in integration directory, allow per-target override
    ansible_mcp_manifest_path: "{{ ansible_mcp_manifest_path | default(integration_dir + '/mcpservers.json') }}"
    github_mcp_pat: "{{ github_mcp_pat | default('') }}"
  tasks:
    # Tasks from roles/setup/tasks/main.yml (inlined for ansible-test compatibility)
    - name: Ensure inventory directory exists
      ansible.builtin.file:
        path: "{{ ansible_mcp_inventory_dir }}"
        state: directory
        mode: '0755'

    - name: Generate inventory file from template
      ansible.builtin.template:
        src: "{{ ansible_mcp_inventory_template | default('inventory.yml.j2') }}"
        dest: "{{ ansible_mcp_inventory_file }}"
        mode: '0644'
